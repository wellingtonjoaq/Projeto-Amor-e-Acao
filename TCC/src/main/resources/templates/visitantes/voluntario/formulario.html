<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seja Voluntário | Projeto Amor & Ação</title>
  <link rel="stylesheet" th:href="@{/css/styleVisitantes.css}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body class="bg-light-gray">

<div th:replace="~{visitantes/navbar/navbar :: navbar}"></div>

<section class="voluntario-banner">
  <div class="voluntario-banner-content">
    <h1 class="banner-title"><i class="fa-solid fa-hand-holding-heart"></i> Seja a mudança que você quer ver</h1>
    <p class="banner-subtitle">
      O seu tempo e dedicação são os bens mais preciosos que você pode doar.
      Junte-se à nossa equipe e ajude a escrever novas histórias.
    </p>
  </div>
</section>

<div class="container-visitante main-matricula-container">

  <div th:if="${erro}" class="alert-box error">
    <i class="fa-solid fa-circle-exclamation"></i> <span th:text="${erro}"></span>
  </div>

  <div class="matricula-form-box">
    <h2 class="form-title">Ficha de Inscrição</h2>

    <form th:action="@{/visitantes/voluntario/salvar}" th:object="${voluntario}" method="post" class="matricula-form">
      <input type="hidden" th:field="*{id}" />

      <div class="matricula-split-layout">

        <div class="matricula-col-left">
          <h3 class="section-form-title">Dados Pessoais</h3>

          <div class="input-group-modern">
            <label for="nomeVoluntario">Nome Completo <span class="required">*</span></label>
            <input id="nomeVoluntario" type="text" th:field="*{nome}" class="input-modern"
                   th:classappend="${#fields.hasErrors('nome')} ? ' field-error' : ''" required />
            <span th:if="${#fields.hasErrors('nome')}" th:errors="*{nome}" class="error-text"></span>
          </div>

          <div class="input-group-modern">
            <label for="cpfVoluntario">CPF <span class="required">*</span></label>
            <input id="cpfVoluntario" type="text" th:field="*{cpf}" class="input-modern"
                   th:classappend="${#fields.hasErrors('cpf')} ? ' field-error' : ''" placeholder="000.000.000-00" required />
            <span th:if="${#fields.hasErrors('cpf')}" th:errors="*{cpf}" class="error-text"></span>
          </div>

          <div class="input-group-modern">
            <label for="emailVoluntario">E-mail <span class="required">*</span></label>
            <input id="emailVoluntario" type="email" th:field="*{email}" class="input-modern"
                   th:classappend="${#fields.hasErrors('email')} ? ' field-error' : ''" required/>
            <span th:if="${#fields.hasErrors('email')}" th:errors="*{email}" class="error-text"></span>
          </div>

          <div class="input-group-modern">
            <label for="telefoneVoluntario">Telefone / WhatsApp <span class="required">*</span></label>
            <input id="telefoneVoluntario" type="text" th:field="*{telefone}" class="input-modern"
                   th:classappend="${#fields.hasErrors('telefone')} ? ' field-error' : ''" placeholder="(00) 00000-0000" required/>
            <span th:if="${#fields.hasErrors('telefone')}" th:errors="*{telefone}" class="error-text"></span>
          </div>

          <div class="input-group-modern radio-group">
            <label class="radio-label-title">Gênero <span class="required">*</span></label>
            <div class="radio-options">
              <label class="radio-option">
                <input type="radio" th:field="*{genero}" value="MASCULINO" required> <span>Masculino</span>
              </label>
              <label class="radio-option">
                <input type="radio" th:field="*{genero}" value="FEMININO"> <span>Feminino</span>
              </label>
              <label class="radio-option">
                <input type="radio" th:field="*{genero}" value="OUTRO"> <span>Outro</span>
              </label>
            </div>
          </div>
        </div>

        <div class="matricula-divider"></div>

        <div class="matricula-col-right">
          <h3 class="section-form-title">Localização & Interesse</h3>

          <div class="input-group-modern">
            <label for="cepVoluntario">CEP (Busca Automática) <span class="required">*</span></label>
            <input id="cepVoluntario" type="text" th:field="*{cep}" class="input-modern"
                   th:classappend="${#fields.hasErrors('cep')} ? ' field-error' : ''" placeholder="00000-000" required/>
            <span th:if="${#fields.hasErrors('cep')}" th:errors="*{cep}" class="error-text"></span>
          </div>

          <div class="input-group-modern">
            <label for="enderecoVoluntario">Endereço</label>
            <input id="enderecoVoluntario" type="text" th:field="*{endereco}" class="input-modern" required/>
          </div>

          <div class="form-row-split">
            <div class="input-group-modern">
              <label for="bairroVoluntario">Bairro</label>
              <input id="bairroVoluntario" type="text" th:field="*{bairro}" class="input-modern" required/>
            </div>
            <div class="input-group-modern">
              <label for="nrCasaVoluntario">Número</label>
              <input id="nrCasaVoluntario" type="text" th:field="*{nrCasa}" class="input-modern" required/>
            </div>
          </div>

          <div class="form-row-split">
            <div class="input-group-modern">
              <label for="cidadeVoluntario">Cidade</label>
              <input id="cidadeVoluntario" type="text" th:field="*{cidade}" class="input-modern" required/>
            </div>
            <div class="input-group-modern">
              <label for="estadoVoluntario">Estado</label>
              <input id="estadoVoluntario" type="text" th:field="*{estado}" class="input-modern" required/>
            </div>
          </div>

          <div class="input-group-modern">
            <label for="funcaoVoluntario">Área de Interesse <span class="required">*</span></label>
            <select id="funcaoVoluntario" th:field="*{funcao}" class="input-modern select-modern" required>
              <option value="" hidden="hidden">Selecione uma função...</option>
              <option th:each="funcao : ${funcoesVoluntario}"
                      th:value="${funcao.id}"
                      th:text="${funcao.nome}"></option>
            </select>
            <span th:if="${#fields.hasErrors('funcao')}" th:errors="*{funcao}" class="error-text"></span>
          </div>

          <div class="input-group-modern">
            <label for="motivacaoVoluntario">Por que quer ser voluntário?</label>
            <input id="motivacaoVoluntario" type="text" th:field="*{motivacao}" class="input-modern"
                   placeholder="Resuma sua motivação..." required/>
          </div>
        </div>
      </div>
        <button type="submit" class="btn-matricular-large btn-voluntario-submit">
          <i class="fa-solid fa-paper-plane"></i> Enviar Inscrição
        </button>
    </form>
  </div>
</div>

<div th:replace="~{visitantes/footer/footer :: footer}"></div>

<div id="message-modal" class="modal-overlay" th:if="${erro != null or sucesso != null}">
  <div class="modal-content">
    <span id="close-modal" class="close-btn">&times;</span>
    <div class="modal-icon" th:if="${sucesso}"><i class="fa-solid fa-check-circle" style="color: green;"></i></div>
    <div class="modal-icon" th:if="${erro}"><i class="fa-solid fa-circle-exclamation" style="color: red;"></i></div>
    <p th:if="${erro}" th:text="${erro}" class="modal-text error"></p>
    <p th:if="${sucesso}" th:text="${sucesso}" class="modal-text success"></p>
  </div>
</div>

<script>
  document.getElementById('cepVoluntario').addEventListener('blur', function () {
      const cep = this.value.replace(/\D/g, '');
      if (cep.length === 8) {
          fetch(`https://viacep.com.br/ws/${cep}/json/`)
              .then(r => r.json())
              .then(data => {
                  if (!data.erro) {
                      document.getElementById('enderecoVoluntario').value = data.logradouro || '';
                      document.getElementById('bairroVoluntario').value = data.bairro || '';
                      document.getElementById('cidadeVoluntario').value = data.localidade || '';
                      document.getElementById('estadoVoluntario').value = data.uf || '';
                      document.getElementById('nrCasaVoluntario').focus();
                  } else {
                      alert('CEP não encontrado!');
                  }
              })
              .catch(() => alert('Erro ao buscar o CEP!'));
      }
  });

  document.addEventListener("DOMContentLoaded", function() {
        const modal = document.getElementById("message-modal");
        const closeBtn = document.getElementById("close-modal");
        if(modal) {
            modal.style.display = "flex";
            closeBtn.addEventListener("click", () => modal.style.display = "none");
            window.addEventListener("click", (e) => { if(e.target === modal) modal.style.display = "none"; });
        }
    });
</script>
</body>
</html>