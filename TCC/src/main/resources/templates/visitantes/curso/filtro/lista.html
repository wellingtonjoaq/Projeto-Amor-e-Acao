<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Cursos Disponíveis | Projeto Amor e Ação</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" th:href="@{/css/styleVisitantes.css}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<div th:replace="~{visitantes/navbar/navbar :: navbar}"></div>

<div class="container-visitante">

  <section class="curso-header-section">
    <h1 class="curso-main-title">Encontre seu próximo curso</h1>
    <p class="curso-intro-text">
      Utilize os filtros abaixo para encontrar a qualificação perfeita para você.
    </p>
  </section>

  <div class="visitante-toolbar">

    <form method="get" th:action="@{/visitantes/cursos/filtrarPesquisa}" class="search-form-visitante">
      <input type="text" name="pesquisa" class="visitante-search-input" placeholder="Buscar por nome do curso..." th:value="${pesquisa}">
      <button class="visitante-search-btn" type="submit">
        <i class="fa fa-search"></i>
      </button>
    </form>

    <div class="filter-wrapper">
      <button class="btn-filter-toggle" id="toggleFilter">
        <i class="fa-solid fa-filter"></i> Filtrar Cursos <i class="fas fa-chevron-down arrow-icon"></i>
      </button>

      <form th:action="@{/visitantes/cursos/filtrar}" method="get" class="filter-dropdown-panel" id="filterPanel">

        <div class="filter-group">
          <div class="filter-label"><i class="fa-solid fa-layer-group"></i> Categorias</div>
          <div class="filter-options-grid">
            <label class="custom-radio"><input type="radio" name="categoria" value="Educação" th:checked="${categoria} == 'Educação'"> <span>Educação</span></label>
            <label class="custom-radio"><input type="radio" name="categoria" value="Saúde" th:checked="${categoria} == 'Saúde'"> <span>Saúde</span></label>
            <label class="custom-radio"><input type="radio" name="categoria" value="Tecnologia" th:checked="${categoria} == 'Tecnologia'"> <span>Tecnologia</span></label>
            <label class="custom-radio"><input type="radio" name="categoria" value="Esporte" th:checked="${categoria} == 'Esporte'"> <span>Esporte</span></label>
            <label class="custom-radio"><input type="radio" name="categoria" value="Arte" th:checked="${categoria} == 'Arte'"> <span>Arte</span></label>
            <label class="custom-radio"><input type="radio" name="categoria" value="Moda" th:checked="${categoria} == 'Moda'"> <span>Moda</span></label>
            <label class="custom-radio"><input type="radio" name="categoria" value="Engenharia" th:checked="${categoria} == 'Engenharia'"> <span>Engenharia</span></label>
            <label class="custom-radio"><input type="radio" name="categoria" value="Agricultura" th:checked="${categoria} == 'Agricultura'"> <span>Agricultura</span></label>
          </div>
        </div>

        <div class="filter-divider"></div>

        <div class="filter-group">
          <div class="filter-label"><i class="fa-solid fa-clock"></i> Período</div>
          <div class="filter-options-row">
            <label class="custom-radio"><input type="radio" name="periodo" value="Manhã" th:checked="${periodo} == 'Manhã'"> <span>Manhã</span></label>
            <label class="custom-radio"><input type="radio" name="periodo" value="Tarde" th:checked="${periodo} == 'Tarde'"> <span>Tarde</span></label>
            <label class="custom-radio"><input type="radio" name="periodo" value="Noite" th:checked="${periodo} == 'Noite'"> <span>Noite</span></label>
            <label class="custom-radio"><input type="radio" name="periodo" value="TODOS" th:checked="${periodo} == 'TODOS'"> <span>Todos</span></label>
          </div>
        </div>

        <button class="btn-apply-filter">
          Aplicar Filtros
        </button>
      </form>
    </div>
  </div>

  <div th:if="${vazio}" class="empty-state-visitante">
    <i class="fa-regular fa-face-frown-open"></i>
    <h2>Nenhum curso encontrado</h2>
    <p>Não encontramos cursos com os filtros aplicados. Tente buscar outra categoria.</p>
    <a th:href="@{/visitantes/cursos}" class="btn-reset">Limpar Filtros</a>
  </div>

  <div class="visitante-card-grid" th:if="${!vazio}">
    <div class="visitante-card" th:each="curso : ${cursos}">
      <div class="visitante-card-header">
        <span class="card-badge" th:text="${curso.periodo}">Manhã</span>
        <img th:if="${curso.foto}" th:src="${curso.foto}" alt="Imagem do curso" class="visitante-card-img">
        <img th:if="${curso.foto == null}" th:src="@{/imagens/default.png}" alt="Sem imagem" class="visitante-card-img">
      </div>

      <div class="visitante-card-body">
        <h2 th:text="${curso.nome}">Nome do Curso</h2>

        <div class="card-info-row">
          <i class="fa-solid fa-user-tie"></i>
          <span th:text="${curso.professor}">Professor</span>
        </div>

        <div class="card-info-row">
          <i class="fa-solid fa-clock"></i>
          <span>Carga: <strong th:text="${curso.cargaHoraria}">0</strong>h</span>
        </div>

        <div class="card-info-row">
          <i class="fa-solid fa-calendar-days"></i>
          <span><span th:text="${curso.dataInicio}">Início</span> até <span th:text="${curso.dataFim}">Fim</span></span>
        </div>

        <div class="card-info-row address">
          <i class="fa-solid fa-location-dot"></i>
          <span th:text="${curso.bairro}">Bairro</span>
        </div>
      </div>

      <div class="visitante-card-footer">
        <a th:href="@{'/visitantes/matricula/' + ${curso.id}}" class="btn-matricular">
          Matricular-se <i class="fa-solid fa-arrow-right"></i>
        </a>
      </div>
    </div>
  </div>

  <div class="pagination-container" th:if="${!vazio and cursos.totalPages > 1}">
    <form th:action="@{/visitantes/cursos}" method="get" class="pagination-form">
      <input type="hidden" name="pesquisa" th:value="${pesquisa}" th:if="${pesquisa}">
      <input type="hidden" name="categoria" th:value="${categoria}" th:if="${categoria}">
      <input type="hidden" name="periodo" th:value="${periodo}" th:if="${periodo}">

      <button th:if="${cursos.hasPrevious()}" type="submit" name="page" th:value="${cursos.number - 1}" class="page-btn" title="Anterior">
        <i class="fa-solid fa-chevron-left"></i>
      </button>

      <div class="page-info">
        Página <span th:text="${cursos.number + 1}">1</span> de <span th:text="${cursos.totalPages}">5</span>
      </div>

      <button th:if="${cursos.hasNext()}" type="submit" name="page" th:value="${cursos.number + 1}" class="page-btn" title="Próximo">
        <i class="fa-solid fa-chevron-right"></i>
      </button>
    </form>
  </div>

  <section class="section-contato-compact">
    <div class="contato-compact-content">
      <p>Dúvidas sobre novas turmas? Fale com a ASSEBE.</p>
      <a th:href="@{https://wa.me/554484593988}" target="_blank" class="btn-whatsapp-small">
        <i class="fa-brands fa-whatsapp"></i> Contato via WhatsApp
      </a>
    </div>
  </section>

</div>

<div th:replace="~{visitantes/footer/footer :: footer}"></div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
      const toggleButton = document.getElementById('toggleFilter');
      const filterPanel = document.getElementById('filterPanel');

      if(toggleButton && filterPanel) {
          toggleButton.addEventListener('click', (e) => {
              e.stopPropagation();
              filterPanel.classList.toggle('show');
              toggleButton.querySelector('.arrow-icon').classList.toggle('rotate');
          });

           document.addEventListener('click', (e) => {
              if (!filterPanel.contains(e.target) && !toggleButton.contains(e.target)) {
                  filterPanel.classList.remove('show');
                  const arrow = toggleButton.querySelector('.arrow-icon');
                  if(arrow) arrow.classList.remove('rotate');
              }
          });
      }
  });
</script>

</body>
</html>